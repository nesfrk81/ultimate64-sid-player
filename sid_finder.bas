10 REM SID FINDER - Simple parser based on raw directory format
20 PRINT CHR$(147);"SID FILE FINDER"
30 PRINT "==============="
40 PRINT
50 PRINT "ENTER PATH TO SID FILES"
55 PRINT "(WITHOUT LEADING /)"
57 PRINT "EXAMPLE: USB0/MUSIC/HVSC/BESTOF"
58 PRINT "(PRESS ENTER FOR CURRENT DIR)"
60 PRINT
65 INPUT "PATH: ";DIR$
70 PRINT
72 REM Strip leading / if user included it
74 IF LEN(DIR$)>0 THEN IF LEFT$(DIR$,1)="/" THEN DIR$=RIGHT$(DIR$,LEN(DIR$)-1)
75 IF DIR$="" THEN PRINT "USING CURRENT DIRECTORY":GOTO 140
90 REM Change directory
100 PRINT "CHANGING TO: /";DIR$
110 OPEN 15,11,15,"CD:/"+DIR$
120 CLOSE 15
130 PRINT "DONE"
135 GOTO 152
140 REM Skip CD if using current directory
152 PRINT "PRESS ANY KEY WHEN DRIVE LED STOPS"
154 GET K$:IF K$="" THEN 154
160 REM Open directory
170 PRINT "OPENING DIRECTORY..."
180 OPEN 1,11,0,"$"
190 PRINT "DONE"
200 PRINT "PRESS ANY KEY WHEN DRIVE LED STOPS"
210 GET K$:IF K$="" THEN 210
220 REM Open output file
230 PRINT "OPENING OUTPUT FILE..."
240 OPEN 2,11,2,"SIDFILES.TXT,S,W"
250 PRINT "DONE"
260 PRINT
270 PRINT "SCANNING FOR .SID FILES..."
280 PRINT#2,"=== SID FILES FOUND ==="
285 IF DIR$="" THEN PRINT#2,"PATH: CURRENT DIRECTORY":GOTO 300
290 PRINT#2,"PATH: /";DIR$
300 PRINT#2,""
310 REM Initialize
320 WORD$=""
330 SIDCOUNT=0
340 CHARCOUNT=0
350 REM Main read loop
360 GET#1,A$
370 CHARCOUNT=CHARCOUNT+1
380 IF CHARCOUNT>1000 THEN GOTO 500
390 IF ST=64 THEN GOTO 500
400 IF ST>64 THEN GOTO 500
410 REM Check if valid filename character
420 IF LEN(A$)<1 THEN GOTO 450
430 C=ASC(A$)
432 REM Valid chars: A-Z (65-90), a-z (97-122), 0-9 (48-57), _ (95), - (45), . (46)
434 ISVALID=0
436 IF C>=65 AND C<=90 THEN ISVALID=1
438 IF C>=97 AND C<=122 THEN ISVALID=1
440 IF C>=48 AND C<=57 THEN ISVALID=1
442 IF C=95 OR C=45 OR C=46 THEN ISVALID=1
444 IF ISVALID=1 THEN WORD$=WORD$+A$:GOTO 360
450 REM Not a valid char - check if we have a .SID file
452 IF LEN(WORD$)<5 THEN WORD$="":GOTO 360
454 REM Check if ends with .SID (need at least X.SID = 5 chars)
456 REM Get last 4 chars and convert to uppercase
458 LAST4$=RIGHT$(WORD$,4)
460 EXT$=""
462 FOR I=1 TO 4
464   CH$=MID$(LAST4$,I,1)
466   CC=ASC(CH$)
468   IF CC>=97 AND CC<=122 THEN CC=CC-32
470   EXT$=EXT$+CHR$(CC)
472 NEXT I
474 IF EXT$<>".SID" THEN WORD$="":GOTO 360
476 REM Found something ending in .SID!
478 REM Check if it contains / (directory path) - skip those
480 HASPATH=0
482 FOR J=1 TO LEN(WORD$)
484   IF MID$(WORD$,J,1)="/" THEN HASPATH=1
486 NEXT J
488 IF HASPATH=1 THEN WORD$="":GOTO 360
490 REM Valid SID file!
492 SIDCOUNT=SIDCOUNT+1
494 PRINT SIDCOUNT;". ";WORD$
496 PRINT#2,WORD$
498 WORD$=""
499 GOTO 360
500 REM Done - check last word too
502 IF LEN(WORD$)<5 THEN GOTO 550
504 LAST4$=RIGHT$(WORD$,4)
506 EXT$=""
508 FOR I=1 TO 4
510   CH$=MID$(LAST4$,I,1)
512   CC=ASC(CH$)
514   IF CC>=97 AND CC<=122 THEN CC=CC-32
516   EXT$=EXT$+CHR$(CC)
518 NEXT I
520 IF EXT$<>".SID" THEN GOTO 550
522 HASPATH=0
524 FOR J=1 TO LEN(WORD$)
526   IF MID$(WORD$,J,1)="/" THEN HASPATH=1
528 NEXT J
530 IF HASPATH=1 THEN GOTO 550
532 SIDCOUNT=SIDCOUNT+1
534 PRINT SIDCOUNT;". ";WORD$
536 PRINT#2,WORD$
550 REM Finished
552 PRINT
554 PRINT "FOUND ";SIDCOUNT;" SID FILES"
556 PRINT#2,""
558 PRINT#2,"TOTAL: ";SIDCOUNT;" FILES"
560 CLOSE 1
562 CLOSE 2
564 PRINT "OUTPUT: SIDFILES.TXT"
570 END
